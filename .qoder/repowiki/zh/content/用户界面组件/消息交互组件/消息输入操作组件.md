# æ¶ˆæ¯è¾“å…¥æ“ä½œç»„ä»¶

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [Attach.tsx](file://src/components/MessageInputActions/Attach.tsx)
- [AttachSmall.tsx](file://src/components/MessageInputActions/AttachSmall.tsx)
- [ChatModelSelector.tsx](file://src/components/MessageInputActions/ChatModelSelector.tsx)
- [Optimization.tsx](file://src/components/MessageInputActions/Optimization.tsx)
- [Sources.tsx](file://src/components/MessageInputActions/Sources.tsx)
- [MessageInput.tsx](file://src/components/MessageInput.tsx)
- [EmptyChatMessageInput.tsx](file://src/components/EmptyChatMessageInput.tsx)
- [useChat.tsx](file://src/lib/hooks/useChat.tsx)
- [types.ts](file://src/lib/models/types.ts)
- [route.ts](file://src/app/api/providers/route.ts)
- [route.ts](file://src/app/api/uploads/route.ts)
- [route.ts](file://src/app/api/chat/route.ts)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
5. [è¯¦ç»†ç»„ä»¶åˆ†æ](#è¯¦ç»†ç»„ä»¶åˆ†æ)
6. [ä¾èµ–å…³ç³»åˆ†æ](#ä¾èµ–å…³ç³»åˆ†æ)
7. [æ€§èƒ½è€ƒè™‘](#æ€§èƒ½è€ƒè™‘)
8. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
9. [ç»“è®º](#ç»“è®º)

## ç®€ä»‹

æ¶ˆæ¯è¾“å…¥æ“ä½œç»„ä»¶æ˜¯ Perplexica èŠå¤©ç•Œé¢çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œè´Ÿè´£å¤„ç†ç”¨æˆ·çš„è¾“å…¥æ“ä½œå’Œç›¸å…³åŠŸèƒ½ã€‚è¯¥ç»„ä»¶é›†åˆæä¾›äº†å®Œæ•´çš„æ¶ˆæ¯è¾“å…¥ä½“éªŒï¼ŒåŒ…æ‹¬é™„ä»¶ä¸Šä¼ ã€æ¨¡å‹é€‰æ‹©ã€ä¼˜åŒ–æ¨¡å¼è®¾ç½®å’Œæ¥æºæ§åˆ¶ç­‰åŠŸèƒ½ã€‚

è¿™äº›ç»„ä»¶é€šè¿‡ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ä¸èŠå¤©ç³»ç»Ÿé›†æˆï¼Œå®ç°äº†é«˜åº¦å¯å®šåˆ¶å’Œå¯æ‰©å±•çš„æ¶ˆæ¯è¾“å…¥åŠŸèƒ½ã€‚æ¯ä¸ªç»„ä»¶éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œæ—¢ä¿è¯äº†ç”¨æˆ·ä½“éªŒçš„ä¸€è‡´æ€§ï¼Œåˆæä¾›äº†è¶³å¤Ÿçš„çµæ´»æ€§æ¥æ»¡è¶³ä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚

## é¡¹ç›®ç»“æ„

æ¶ˆæ¯è¾“å…¥æ“ä½œç»„ä»¶ä½äº `src/components/MessageInputActions/` ç›®å½•ä¸‹ï¼ŒåŒ…å«ä»¥ä¸‹äº”ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š

```mermaid
graph TB
subgraph "æ¶ˆæ¯è¾“å…¥æ“ä½œç»„ä»¶"
Attach[Attach ç»„ä»¶<br/>å®Œæ•´ç‰ˆé™„ä»¶ä¸Šä¼ ]
AttachSmall[AttachSmall ç»„ä»¶<br/>ç²¾ç®€ç‰ˆé™„ä»¶ä¸Šä¼ ]
ModelSelector[ChatModelSelector ç»„ä»¶<br/>èŠå¤©æ¨¡å‹é€‰æ‹©å™¨]
Optimization[Optimization ç»„ä»¶<br/>ä¼˜åŒ–æ¨¡å¼æ§åˆ¶]
Sources[Sources ç»„ä»¶<br/>æ¥æºæ§åˆ¶]
end
subgraph "é›†æˆç»„ä»¶"
MessageInput[MessageInput ç»„ä»¶<br/>ä¸»æ¶ˆæ¯è¾“å…¥æ¡†]
EmptyChatInput[EmptyChatMessageInput ç»„ä»¶<br/>ç©ºèŠå¤©è¾“å…¥æ¡†]
end
subgraph "çŠ¶æ€ç®¡ç†"
useChat[useChat é’©å­<br/>å…¨å±€çŠ¶æ€ç®¡ç†]
end
Attach --> useChat
AttachSmall --> useChat
ModelSelector --> useChat
Optimization --> useChat
Sources --> useChat
MessageInput --> AttachSmall
EmptyChatInput --> Attach
EmptyChatInput --> ModelSelector
EmptyChatInput --> Sources
MessageInput --> useChat
EmptyChatInput --> useChat
```

**å›¾è¡¨æ¥æº**
- [Attach.tsx](file://src/components/MessageInputActions/Attach.tsx#L1-L170)
- [AttachSmall.tsx](file://src/components/MessageInputActions/AttachSmall.tsx#L1-L159)
- [ChatModelSelector.tsx](file://src/components/MessageInputActions/ChatModelSelector.tsx#L1-L204)
- [Optimization.tsx](file://src/components/MessageInputActions/Optimization.tsx#L1-L115)
- [Sources.tsx](file://src/components/MessageInputActions/Sources.tsx#L1-L94)

**ç« èŠ‚æ¥æº**
- [Attach.tsx](file://src/components/MessageInputActions/Attach.tsx#L1-L170)
- [AttachSmall.tsx](file://src/components/MessageInputActions/AttachSmall.tsx#L1-L159)
- [ChatModelSelector.tsx](file://src/components/MessageInputActions/ChatModelSelector.tsx#L1-L204)
- [Optimization.tsx](file://src/components/MessageInputActions/Optimization.tsx#L1-L115)
- [Sources.tsx](file://src/components/MessageInputActions/Sources.tsx#L1-L94)

## æ ¸å¿ƒç»„ä»¶

æ¶ˆæ¯è¾“å…¥æ“ä½œç»„ä»¶é›†åˆåŒ…å«äº”ä¸ªä¸»è¦ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æœ‰å…¶ç‰¹å®šçš„åŠŸèƒ½å’Œä½¿ç”¨åœºæ™¯ï¼š

### é™„ä»¶ä¸Šä¼ ç»„ä»¶

- **Attach ç»„ä»¶**ï¼šå®Œæ•´ç‰ˆé™„ä»¶ä¸Šä¼ ç»„ä»¶ï¼Œæä¾›ä¸°å¯Œçš„äº¤äº’åŠŸèƒ½å’Œæ–‡ä»¶ç®¡ç†èƒ½åŠ›
- **AttachSmall ç»„ä»¶**ï¼šç²¾ç®€ç‰ˆé™„ä»¶ä¸Šä¼ ç»„ä»¶ï¼Œé€‚ç”¨äºç©ºé—´æœ‰é™çš„åœºæ™¯

### æ¨¡å‹é€‰æ‹©ç»„ä»¶

- **ChatModelSelector ç»„ä»¶**ï¼šèŠå¤©æ¨¡å‹é€‰æ‹©å™¨ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©å’Œåˆ‡æ¢ä¸åŒçš„ AI æ¨¡å‹

### ä¼˜åŒ–æ§åˆ¶ç»„ä»¶

- **Optimization ç»„ä»¶**ï¼šä¼˜åŒ–æ¨¡å¼æ§åˆ¶ï¼Œæä¾›é€Ÿåº¦ã€å¹³è¡¡å’Œè´¨é‡ä¸‰ç§ä¼˜åŒ–æ¨¡å¼

### æ¥æºæ§åˆ¶ç»„ä»¶

- **Sources ç»„ä»¶**ï¼šæœç´¢æ¥æºæ§åˆ¶ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©ä¸åŒçš„æœç´¢æ¥æºç±»å‹

**ç« èŠ‚æ¥æº**
- [Attach.tsx](file://src/components/MessageInputActions/Attach.tsx#L22-L170)
- [AttachSmall.tsx](file://src/components/MessageInputActions/AttachSmall.tsx#L13-L159)
- [ChatModelSelector.tsx](file://src/components/MessageInputActions/ChatModelSelector.tsx#L11-L204)
- [Optimization.tsx](file://src/components/MessageInputActions/Optimization.tsx#L39-L115)
- [Sources.tsx](file://src/components/MessageInputActions/Sources.tsx#L33-L94)

## æ¶æ„æ¦‚è§ˆ

æ¶ˆæ¯è¾“å…¥æ“ä½œç»„ä»¶é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œé€šè¿‡ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†æœºåˆ¶å®ç°ç»„ä»¶é—´çš„åä½œï¼š

```mermaid
sequenceDiagram
participant User as ç”¨æˆ·
participant Input as MessageInput
participant Actions as æ“ä½œç»„ä»¶
participant Hook as useChat Hook
participant API as åç«¯API
participant Agent as æœç´¢ä»£ç†
User->>Input : è¾“å…¥æ¶ˆæ¯
Input->>Actions : è§¦å‘é™„ä»¶ä¸Šä¼ /æ¨¡å‹é€‰æ‹©
Actions->>Hook : æ›´æ–°çŠ¶æ€
Hook->>API : å‘é€è¯·æ±‚
API->>Agent : å¤„ç†æœç´¢è¯·æ±‚
Agent->>API : è¿”å›ç»“æœæµ
API->>Hook : æµå¼å“åº”
Hook->>Actions : æ›´æ–°UIçŠ¶æ€
Actions->>User : æ˜¾ç¤ºç»“æœ
Note over User,Agent : å®Œæ•´çš„æ¶ˆæ¯å¤„ç†æµç¨‹
```

**å›¾è¡¨æ¥æº**
- [MessageInput.tsx](file://src/components/MessageInput.tsx#L8-L103)
- [useChat.tsx](file://src/lib/hooks/useChat.tsx#L714-L800)
- [route.ts](file://src/app/api/chat/route.ts#L103-L255)

**ç« èŠ‚æ¥æº**
- [MessageInput.tsx](file://src/components/MessageInput.tsx#L8-L103)
- [useChat.tsx](file://src/lib/hooks/useChat.tsx#L714-L800)
- [route.ts](file://src/app/api/chat/route.ts#L103-L255)

## è¯¦ç»†ç»„ä»¶åˆ†æ

### é™„ä»¶ä¸Šä¼ ç»„ä»¶

#### Attach ç»„ä»¶åˆ†æ

Attach ç»„ä»¶æä¾›äº†å®Œæ•´çš„é™„ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

```mermaid
classDiagram
class Attach {
+files : File[]
+setFiles : Function
+fileIds : string[]
+setFileIds : Function
+loading : boolean
+handleChange : Function
+render() : JSX.Element
}
class File {
+fileName : string
+fileExtension : string
+fileId : string
}
class UploadManager {
+processFiles(files) : Promise<File[]>
+storeFile(file) : Promise<string>
}
Attach --> File : manages
Attach --> UploadManager : uses
```

**å›¾è¡¨æ¥æº**
- [Attach.tsx](file://src/components/MessageInputActions/Attach.tsx#L22-L170)
- [useChat.tsx](file://src/lib/hooks/useChat.tsx#L64-L78)

**å®ç°è¦ç‚¹**ï¼š
- æ”¯æŒå¤šæ–‡ä»¶åŒæ—¶ä¸Šä¼ 
- è‡ªåŠ¨æ£€æµ‹åµŒå…¥æ¨¡å‹é…ç½®
- æä¾›æ–‡ä»¶é¢„è§ˆå’Œç®¡ç†åŠŸèƒ½
- å®æ—¶çŠ¶æ€æ›´æ–°å’Œé”™è¯¯å¤„ç†

#### AttachSmall ç»„ä»¶åˆ†æ

AttachSmall ç»„ä»¶æ˜¯ Attach ç»„ä»¶çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä¸“ä¸ºç©ºé—´æœ‰é™çš„åœºæ™¯è®¾è®¡ï¼š

**ä¸»è¦å·®å¼‚**ï¼š
- æ›´ç®€æ´çš„UIè®¾è®¡
- å‡å°‘çš„äº¤äº’å…ƒç´ 
- é€‚é…ç§»åŠ¨ç«¯æ˜¾ç¤º
- ä¿æŒæ ¸å¿ƒåŠŸèƒ½å®Œæ•´æ€§

**ç« èŠ‚æ¥æº**
- [Attach.tsx](file://src/components/MessageInputActions/Attach.tsx#L22-L170)
- [AttachSmall.tsx](file://src/components/MessageInputActions/AttachSmall.tsx#L13-L159)

### èŠå¤©æ¨¡å‹é€‰æ‹©å™¨

#### ChatModelSelector ç»„ä»¶åˆ†æ

æ¨¡å‹é€‰æ‹©å™¨ç»„ä»¶æä¾›äº†æ™ºèƒ½çš„æ¨¡å‹é€‰æ‹©åŠŸèƒ½ï¼š

```mermaid
flowchart TD
Start([ç»„ä»¶åˆå§‹åŒ–]) --> LoadProviders[åŠ è½½æ¨¡å‹æä¾›å•†]
LoadProviders --> CheckConfig{é…ç½®æ£€æŸ¥}
CheckConfig --> |æˆåŠŸ| FilterModels[è¿‡æ»¤å¯ç”¨æ¨¡å‹]
CheckConfig --> |å¤±è´¥| ShowError[æ˜¾ç¤ºé”™è¯¯]
FilterModels --> RenderList[æ¸²æŸ“æ¨¡å‹åˆ—è¡¨]
RenderList --> UserSelect{ç”¨æˆ·é€‰æ‹©}
UserSelect --> |é€‰æ‹©| UpdateState[æ›´æ–°çŠ¶æ€]
UserSelect --> |å–æ¶ˆ| ClosePanel[å…³é—­é¢æ¿]
UpdateState --> SaveLocal[ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨]
SaveLocal --> End([å®Œæˆ])
ShowError --> End
ClosePanel --> End
```

**å›¾è¡¨æ¥æº**
- [ChatModelSelector.tsx](file://src/components/MessageInputActions/ChatModelSelector.tsx#L18-L75)

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- åŠ¨æ€åŠ è½½å¯ç”¨çš„æ¨¡å‹æä¾›å•†
- æ™ºèƒ½æœç´¢å’Œè¿‡æ»¤æ¨¡å‹
- ä¼˜å…ˆæ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„æ¨¡å‹
- æœ¬åœ°å­˜å‚¨ç”¨æˆ·åå¥½è®¾ç½®

**ç« èŠ‚æ¥æº**
- [ChatModelSelector.tsx](file://src/components/MessageInputActions/ChatModelSelector.tsx#L11-L204)
- [route.ts](file://src/app/api/providers/route.ts#L5-L34)

### ä¼˜åŒ–æ¨¡å¼æ§åˆ¶

#### Optimization ç»„ä»¶åˆ†æ

ä¼˜åŒ–ç»„ä»¶æä¾›äº†ä¸‰ç§ä¸åŒçš„ä¼˜åŒ–æ¨¡å¼ï¼š

| æ¨¡å¼ | å›¾æ ‡ | æè¿° | æ€§èƒ½ç‰¹å¾ |
|------|------|------|----------|
| Speed | âš¡ | ä¼˜å…ˆé€Ÿåº¦ï¼Œå¿«é€Ÿå“åº” | æœ€å¿«å“åº”æ—¶é—´ |
| Balanced | ğŸ”„ | é€Ÿåº¦ä¸å‡†ç¡®æ€§å¹³è¡¡ | ä¸­ç­‰æ€§èƒ½ |
| Quality | â­ | æœ€å…¨é¢å’Œå‡†ç¡®çš„ç­”æ¡ˆ | æœ€æ…¢ä½†æœ€ç²¾ç¡® |

```mermaid
stateDiagram-v2
[*] --> Speed
Speed --> Balanced : ç”¨æˆ·åˆ‡æ¢
Balanced --> Quality : ç”¨æˆ·åˆ‡æ¢
Quality --> Speed : ç”¨æˆ·åˆ‡æ¢
state Speed {
[*] --> FastResponse
FastResponse --> MinimalProcessing
}
state Balanced {
[*] --> ModerateResponse
ModerateResponse --> BalancedProcessing
}
state Quality {
[*] --> ThoroughResponse
ThoroughResponse --> ComprehensiveProcessing
}
```

**å›¾è¡¨æ¥æº**
- [Optimization.tsx](file://src/components/MessageInputActions/Optimization.tsx#L13-L37)

**ç« èŠ‚æ¥æº**
- [Optimization.tsx](file://src/components/MessageInputActions/Optimization.tsx#L39-L115)

### æ¥æºæ§åˆ¶ç»„ä»¶

#### Sources ç»„ä»¶åˆ†æ

æ¥æºæ§åˆ¶ç»„ä»¶å…è®¸ç”¨æˆ·é€‰æ‹©ä¸åŒçš„æœç´¢æ¥æºï¼š

**æ”¯æŒçš„æ¥æºç±»å‹**ï¼š
- Webï¼šé€šç”¨ç½‘ç»œæœç´¢
- Academicï¼šå­¦æœ¯èµ„æºæœç´¢
- Discussionsï¼šç¤¾äº¤è®¨è®ºå†…å®¹

```mermaid
graph LR
subgraph "æœç´¢æ¥æº"
Web[Web æœç´¢<br/>ğŸŒ]
Academic[å­¦æœ¯æœç´¢<br/>ğŸ“]
Social[ç¤¾äº¤æœç´¢<br/>ğŸ‘¥]
end
subgraph "ç”¨æˆ·æ§åˆ¶"
Toggle[å¼€å…³æ§åˆ¶<br/>ğŸ”˜]
Icon[å›¾æ ‡æ˜¾ç¤º<br/>ğŸ¨]
end
Web --> Toggle
Academic --> Toggle
Social --> Toggle
Toggle --> Icon
```

**å›¾è¡¨æ¥æº**
- [Sources.tsx](file://src/components/MessageInputActions/Sources.tsx#L15-L31)

**ç« èŠ‚æ¥æº**
- [Sources.tsx](file://src/components/MessageInputActions/Sources.tsx#L33-L94)

### çŠ¶æ€ç®¡ç†é›†æˆ

æ‰€æœ‰æ¶ˆæ¯è¾“å…¥æ“ä½œç»„ä»¶éƒ½é€šè¿‡ `useChat` é’©å­è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼š

```mermaid
classDiagram
class ChatContext {
+messages : Message[]
+sections : Section[]
+files : File[]
+sources : string[]
+optimizationMode : string
+chatModelProvider : ChatModelProvider
+sendMessage : Function
+setFiles : Function
+setSources : Function
+setOptimizationMode : Function
+setChatModelProvider : Function
}
class Attach {
+handleChange : Function
+setFiles : Function
+setFileIds : Function
}
class ChatModelSelector {
+handleModelSelect : Function
+setChatModelProvider : Function
}
class Optimization {
+setOptimizationMode : Function
}
class Sources {
+setSources : Function
}
Attach --> ChatContext : uses
ChatModelSelector --> ChatContext : uses
Optimization --> ChatContext : uses
Sources --> ChatContext : uses
```

**å›¾è¡¨æ¥æº**
- [useChat.tsx](file://src/lib/hooks/useChat.tsx#L31-L62)

**ç« èŠ‚æ¥æº**
- [useChat.tsx](file://src/lib/hooks/useChat.tsx#L31-L62)

## ä¾èµ–å…³ç³»åˆ†æ

æ¶ˆæ¯è¾“å…¥æ“ä½œç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»å¦‚ä¸‹ï¼š

```mermaid
graph TB
subgraph "å¤–éƒ¨ä¾èµ–"
HeadlessUI[HeadlessUI<br/>å¼¹å‡ºé¢æ¿ç»„ä»¶]
Lucide[Lucide Icons<br/>å›¾æ ‡åº“]
Motion[Motion<br/>åŠ¨ç”»åº“]
Framer[Framer Motion<br/>åŠ¨ç”»ç»„ä»¶]
end
subgraph "å†…éƒ¨ä¾èµ–"
Utils[utils å·¥å…·å‡½æ•°<br/>æ ·å¼å·¥å…·]
Hooks[hooks é’©å­<br/>çŠ¶æ€ç®¡ç†]
Types[types ç±»å‹å®šä¹‰<br/>æ¥å£è§„èŒƒ]
end
subgraph "ç»„ä»¶å±‚æ¬¡"
Attach --> HeadlessUI
Attach --> Lucide
Attach --> Motion
AttachSmall --> HeadlessUI
AttachSmall --> Lucide
AttachSmall --> Motion
ChatModelSelector --> HeadlessUI
ChatModelSelector --> Lucide
ChatModelSelector --> Motion
Optimization --> HeadlessUI
Optimization --> Lucide
Optimization --> Motion
Sources --> HeadlessUI
Sources --> Lucide
Sources --> Motion
end
Attach --> Utils
AttachSmall --> Utils
ChatModelSelector --> Utils
Optimization --> Utils
Sources --> Utils
Attach --> Hooks
AttachSmall --> Hooks
ChatModelSelector --> Hooks
Optimization --> Hooks
Sources --> Hooks
Attach --> Types
AttachSmall --> Types
ChatModelSelector --> Types
Optimization --> Types
Sources --> Types
```

**å›¾è¡¨æ¥æº**
- [Attach.tsx](file://src/components/MessageInputActions/Attach.tsx#L1-L21)
- [AttachSmall.tsx](file://src/components/MessageInputActions/AttachSmall.tsx#L1-L12)
- [ChatModelSelector.tsx](file://src/components/MessageInputActions/ChatModelSelector.tsx#L1-L10)
- [Optimization.tsx](file://src/components/MessageInputActions/Optimization.tsx#L1-L12)
- [Sources.tsx](file://src/components/MessageInputActions/Sources.tsx#L1-L13)

**ç« èŠ‚æ¥æº**
- [Attach.tsx](file://src/components/MessageInputActions/Attach.tsx#L1-L21)
- [AttachSmall.tsx](file://src/components/MessageInputActions/AttachSmall.tsx#L1-L12)
- [ChatModelSelector.tsx](file://src/components/MessageInputActions/ChatModelSelector.tsx#L1-L10)
- [Optimization.tsx](file://src/components/MessageInputActions/Optimization.tsx#L1-L12)
- [Sources.tsx](file://src/components/MessageInputActions/Sources.tsx#L1-L13)

## æ€§èƒ½è€ƒè™‘

æ¶ˆæ¯è¾“å…¥æ“ä½œç»„ä»¶åœ¨è®¾è®¡æ—¶å……åˆ†è€ƒè™‘äº†æ€§èƒ½ä¼˜åŒ–ï¼š

### æ¸²æŸ“ä¼˜åŒ–
- ä½¿ç”¨ React.memo å’Œ useMemo é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
- æ¡ä»¶æ¸²æŸ“å‡å°‘ DOM å…ƒç´ æ•°é‡
- åŠ¨ç”»ç»„ä»¶æŒ‰éœ€åŠ è½½ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹

### ç½‘ç»œä¼˜åŒ–
- æ–‡ä»¶ä¸Šä¼ ä½¿ç”¨ FormData æ ¼å¼ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 
- æ¨¡å‹åˆ—è¡¨ç¼“å­˜ï¼Œå‡å°‘é‡å¤è¯·æ±‚
- æµå¼å“åº”å¤„ç†ï¼Œå®æ—¶æ›´æ–° UI

### å†…å­˜ç®¡ç†
- åŠæ—¶æ¸…ç†äº‹ä»¶ç›‘å¬å™¨
- åˆç†çš„ç»„ä»¶å¸è½½å¤„ç†
- é¿å…å†…å­˜æ³„æ¼

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

**é™„ä»¶ä¸Šä¼ å¤±è´¥**
- æ£€æŸ¥åµŒå…¥æ¨¡å‹é…ç½®æ˜¯å¦æ­£ç¡®
- ç¡®è®¤æ–‡ä»¶æ ¼å¼æ”¯æŒæƒ…å†µ
- éªŒè¯ç½‘ç»œè¿æ¥ç¨³å®šæ€§

**æ¨¡å‹é€‰æ‹©å™¨æ— å“åº”**
- ç¡®è®¤åç«¯ API å¯ç”¨æ€§
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
- éªŒè¯æœ¬åœ°å­˜å‚¨æƒé™

**ä¼˜åŒ–æ¨¡å¼ä¸ç”Ÿæ•ˆ**
- æ£€æŸ¥ä¼˜åŒ–æ¨¡å¼å‚æ•°ä¼ é€’
- ç¡®è®¤åç«¯æœç´¢ä»£ç†é…ç½®
- éªŒè¯ç³»ç»ŸæŒ‡ä»¤è®¾ç½®

**ç« èŠ‚æ¥æº**
- [route.ts](file://src/app/api/uploads/route.ts#L5-L40)
- [route.ts](file://src/app/api/providers/route.ts#L5-L34)
- [route.ts](file://src/app/api/chat/route.ts#L103-L255)

## ç»“è®º

æ¶ˆæ¯è¾“å…¥æ“ä½œç»„ä»¶é›†åˆä¸º Perplexica æä¾›äº†å®Œæ•´è€Œçµæ´»çš„æ¶ˆæ¯è¾“å…¥è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡æ¨¡å—åŒ–è®¾è®¡å’Œç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†ï¼Œè¿™äº›ç»„ä»¶ä¸ä»…æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½ç‰¹æ€§ï¼Œè¿˜ç¡®ä¿äº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå’Œä»£ç å¯ç»´æŠ¤æ€§ã€‚

å„ä¸ªç»„ä»¶ä¹‹é—´çš„åä½œå…³ç³»æ¸…æ™°æ˜ç¡®ï¼Œæ•°æ®æµå‘åˆç†é«˜æ•ˆã€‚æ— è®ºæ˜¯å®Œæ•´çš„ Attach ç»„ä»¶è¿˜æ˜¯ç²¾ç®€çš„ AttachSmall ç»„ä»¶ï¼Œéƒ½èƒ½æ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„éœ€æ±‚ã€‚æ¨¡å‹é€‰æ‹©å™¨ã€ä¼˜åŒ–æ§åˆ¶å’Œæ¥æºç®¡ç†ç­‰åŠŸèƒ½çš„é›†æˆï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿæ ¹æ®è‡ªå·±çš„éœ€æ±‚å®šåˆ¶æœç´¢ä½“éªŒã€‚

æœªæ¥çš„å‘å±•æ–¹å‘å¯ä»¥åŒ…æ‹¬ï¼š
- æ›´æ™ºèƒ½çš„æ–‡ä»¶ç±»å‹è¯†åˆ«å’Œå¤„ç†
- æ›´ä¸°å¯Œçš„æ¨¡å‹é…ç½®é€‰é¡¹
- æ›´ç²¾ç»†çš„æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–
- æ›´å¥½çš„æ— éšœç¢è®¿é—®æ”¯æŒ

è¿™äº›ç»„ä»¶ä¸ºæ„å»ºé«˜è´¨é‡çš„èŠå¤©åº”ç”¨å¥ å®šäº†åšå®çš„åŸºç¡€ï¼Œæ˜¯ Perplexica é¡¹ç›®ä¸­ä¸å¯æˆ–ç¼ºçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚